---
## Author
author:
  name: Калашникова Ольга Сергеевна
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1132231846@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: "Отчёт по лабораторной работе № 1"
subtitle: "Администрирование сетевых подсистем"
license: "CC BY"
---

# Цель работы

Целью данной работы является приобретение практических навыков установки Rocky Linux на виртуальную машину с помощью инструмента Vagrant.

# Задание

1. Сформируйте box-файл с дистрибутивом Rocky Linux для VirtualBox (см. раздел 1.5.2 или 1.5.3).

2. Запустите виртуальные машины сервера и клиента и убедитесь в их работоспособности.

3. Внесите изменения в настройки загрузки образов виртуальных машин server и client, добавив пользователя с правами администратора и изменив названия хостов (см. раздел 1.5.4).

4. Скопируйте необходимые для работы с Vagrant файлы и box-файлы виртуальных машин на внешний носитель. Используя эти файлы, вы можете попробовать развернуть виртуальные машины на другом компьютере.

# Выполнение лабораторной работы

## Предварительные настройки

Создаём каталог для проекта. У меня получилось `C:\work\oskalashnikova\code\packer` и `C:\work\oskalashnikova\code\vagrant` ([рис. @fig-001]).

![Каталоги](image/1.png){#fig-001 width=70%}

В созданном рабочем каталоге в подкаталоге packer разместите образ варианта операционной системы Rocky Linux. Так же в подкаталоге packer разместим файл vagrant-rocky.pkr.hcl — специальный файл с описанием метаданных по установке дистрибутива на виртуальную машину и подкаталог http с файлом ks.cfg — определяет настройки для установки дистрибутива, которые пользователь обычно вводит вручную, в частности настройки языка интерфейса, языковые настройки клавиатуры, тайм-зону, сетевые настройки и т.п. ([рис. @fig-002]).

![Образ варианта операционной системы Rocky Linux и необходимый файл и папка](image/2.png){#fig-002 width=70%}

В подкаталоге vagrant создаём файл Vagrantfile — файл с конфигурацией запуска виртуальных машин — сервера и клиента и файл Makefile — набор инструкций для программы make по работе с Vagrant ([рис. @fig-003]).

![Файлы в подкаталоге vagrant](image/3.png){#fig-003 width=70%}

В этом же рабочем каталоге в подкаталоге vagrant создаём каталог provision с подкаталогами default, server и client, в которых будут размещаться скрипты, изменяющие настройки внутреннего окружения базового (общего) образа виртуальной машины, сервера или клиента соответственно ([рис. @fig-004]).

![Каталог provision с подкаталогами default, server и client](image/4.png){#fig-004 width=70%}

В каталоге default разместим скрипт-заглушку 01-dummy.sh, скрипт 01-user.sh и скрипт 01-hostname.sh по изменению названия виртуальной машины ([рис. @fig-005]).

![Скрипты в каталоге default](image/5.png){#fig-005 width=70%}

В каталоге server разместим скрипт-заглушку 01-dummy.sh и скрипт 02-forward.sh, который обеспечивает корректную маршрутизацию ip-адресов между сервером и клиентом ([рис. @fig-006]).

![Скрипты в каталоге server](image/6.png){#fig-006 width=70%}

В каталоге client разместим скрипт-заглушку 01-dummy.sh и скрипт 01-routing.sh , который обеспечивает корректную работу сетевых интерфейсов клиента ([рис. @fig-007]).

![Скрипты в каталоге client](image/7.png){#fig-007 width=70%}

## Развёртывание лабораторного стенда на ОС Windows

Используя FAR, перейдём в созданный рабочий каталог с проектом. В командной строке введём packer.exe init vagrant-rocky.pkr.hcl для начала автоматической установки образа операционной системы Rocky Linux в VirtualBox ([рис. @fig-008]).

![init](image/8.png){#fig-008 width=70%}

В командной строке введёмpacker.exe build vagrant-rocky.pkr.hcl для формирования box-файла с дистрибутивом Rocky Linux для VirtualBox ([рис. @fig-009]).

![build](image/9.png){#fig-009 width=70%}

Для регистрации образа виртуальной машины в vagrant в командной строке введём vagrant box add rocky9 vagrant-virtualbox-rocky-9-x86_64.box ([рис. @fig-010]).

![Регистрация образа](image/10.png){#fig-010 width=70%}

Для запуска виртуальной машины Server введём в консоли `vagrant up server` ([рис. @fig-011]).

![Запуск виртуальной машины Server](image/11.png){#fig-011 width=70%}

Для запуска виртуальной машины Client введём в консоли `vagrant up client` ([рис. @fig-012]).

![Запуск виртуальной машины Client](image/12.png){#fig-012 width=70%}

Подключимся к серверу из консоли с помощью команды `vagrant ssh server` ([рис. @fig-013]).  
Вводим пароль `vagrant`.   Пробуем перейти к пользователю `user` с помощью команды `su - user`, но получаем ошибку, так как пользователь `user` не создан.  Пользователь должен быть создан с помощью скрипта `01-user.sh`, где вместо `user` указан логин студента. В данном случае логин — `oskalashnikova`.  Пробуем перейти к пользователю `oskalashnikova` с помощью команды `su - oskalashnikova`. Вводим пароль (указанный в скрипте `01-user.sh`). После успешного входа завершаем сеанс с помощью команды `exit`.

![Подключение к серверу](image/13.png){#fig-013 width=70%}

Подключимся к клиенту из консоли с помощью команды `vagrant ssh client` ([рис. @fig-014]).  
Вводим пароль `vagrant`. После успешного подключения завершаем сеанс с помощью команды `exit`.

![Подключение к клиенту](image/14.png){#fig-014 width=70%}

Выключаем виртуальную машину Server с помощью команды `vagrant halt server` ([рис. @fig-015]).

![Выключение сервера](image/15.png){#fig-015 width=70%}

Выключаем виртуальную машину Client с помощью команды `vagrant halt client` ([рис. @fig-016]).

![Выключение клиента](image/16.png){#fig-016 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

Перед выполнением провижининга убедимся, что в файле `Vagrantfile` присутствуют строки, отвечающие за выполнение скриптов `01-user.sh` и `01-hostname.sh` ([рис. @fig-017]). Эти секции гарантируют, что при запуске виртуальных машин будут выполнены скрипты для изменения имени хоста и создания пользователя с административными правами.

![Проверка конфигурации Vagrantfile](image/17.png){#fig-017 width=70%}

Для применения изменений на виртуальной машине Server выполним команду:```vagrant up server --provision``` ([рис. @fig-018]). 

![Запуск сервера](image/18.png){#fig-018 width=70%}

Для применения изменений на виртуальной машине Client выполним команду:```vagrant up client --provision``` ([рис. @fig-019]). 

![Запуск клиента](image/19.png){#fig-019 width=70%}

Подключимся к виртуальным машинам и убедимся, что изменения применены корректно. Подключаемся к серверу и проверяем имя пользователя и хоста. В приглашении терминала отображается формат: oskalashnikova@server, но мне это никак не помешало в дальнейшем ([рис. @fig-021]).

![Проверка пользователя на сервере](image/21.png){#fig-021 width=70%}

Аналогично подключаемся к клиенту. Приглашение терминала отображается в формате: oskalashnikova@client.oskalashnikova.net ([рис. @fig-020]).

![Проверка пользователя на клиенте](image/20.png){#fig-020 width=70%}

После проверки внесённых изменений выключаем виртуальные машины

```
vagrant halt server
vagrant halt client
```

После выключения машин копируем все необходимые для развёртывания файлы на внешний носитель или в другой каталог

## Выводы

В ходе выполнения данной работы были приобретены практические навыки установки Rocky Linux на виртуальную машину с помощью инструмента Vagrant.
