---
# Preamble

## Author
author:
  name: Калашникова Ольга Сергеевна
  email: 1132231846@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №15
subtitle: Администрирование сетевых подсистем
license: CC BY
date: 2025-12-13

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: Liberation Serif
romanfont: Liberation Serif
sansfont: Liberation Sans
monofont: Liberation Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---
# Введение

## Цель работы

Получение навыков по работе с журналами системных событий.

# Выполнение лабораторной работы

## Настройка сервера сетевого журнала

На сервере переключимся на пользователя root и перейдём в каталог конфигурации rsyslog: ```cd /etc/rsyslog.d```. Создадим файл конфигурации для сетевого журналирования: ```touch netlog-server.conf```  ([рис. @fig-001]).

![Переход в каталог конфигурации rsyslog](image/1.png){#fig-001 width=70%}

## Настройка сервера сетевого журнала

Откроем файл для редактирования и добавим следующие строки для включения приёма сообщений по TCP-порту 514: ```$ModLoad imtcp```, ```$InputTCPServerRun 514``` ([рис. @fig-002]).

![Настройка приёма сообщений по TCP](image/2.png){#fig-002 width=70%}

## Настройка сервера сетевого журнала

Перезапустим службу rsyslog для применения изменений: ```systemctl restart rsyslog``` ([рис. @fig-003]).

![Перезапуск службы rsyslog](image/3.png){#fig-003 width=70%}

## Настройка сервера сетевого журнала

Проверим, что служба прослушивает TCP-порт 514: ```lsof -i :514``` или ```ss -tlnp | grep 514```. На скриншоте видно, что сервер готов принимать соединения по TCP-порту 514 ([рис. @fig-004]).

![Проверка открытого порта TCP 514](image/4.png){#fig-004 width=70%}

## Настройка сервера сетевого журнала

Настроим межсетевой экран для разрешения входящих соединений по TCP-порту 514: ```firewall-cmd --add-port=514/tcp```, ```firewall-cmd --add-port=514/tcp --permanent``` ([рис. @fig-005]).

![Настройка межсетевого экрана](image/5.png){#fig-005 width=70%}

## Настройка клиента сетевого журнала

На клиенте переключимся на пользователя root и перейдём в каталог конфигурации rsyslog: ```cd /etc/rsyslog.d```. Создадим файл конфигурации для клиента сетевого журналирования: ```touch netlog-client.conf``` ([рис. @fig-006]).

![Переход в каталог конфигурации rsyslog на клиенте](image/6.png){#fig-006 width=70%}

## Настройка клиента сетевого журнала

Откроем файл для редактирования и добавим строку для перенаправления всех системных сообщений на сервер журналирования по TCP-порту 514: ```*.* @@server.oskalashnikova.net:514``` ([рис. @fig-007]).

![Настройка перенаправления сообщений на сервер](image/7.png){#fig-007 width=70%}

## Настройка клиента сетевого журнала

Перезапустим службу rsyslog на клиенте для применения изменений: ```systemctl restart rsyslog``` ([рис. @fig-008]).

![Перезапуск службы rsyslog на клиенте](image/8.png){#fig-008 width=70%}

## Просмотр журнала

На сервере проверим работу сетевого журналирования, просмотрев журнал системных сообщений: ```tail -f /var/log/messages```. В логах видны сообщения с именем хоста `server`, что подтверждает работу локального журналирования ([рис. @fig-009]).

![Просмотр журнала на сервере](image/9.png){#fig-009 width=70%}

## Просмотр журнала

На сервере также просмотрим запущенные процессы с помощью графического монитора системы: ```gnome-system-monitor``` ([рис. @fig-010]).

![Просмотр процессов в gnome-system-monitor](image/10.png){#fig-010 width=70%}

## Просмотр журнала

Попробуем установить просмотрщик журналов через стандартный менеджер пакетов. Сначала установим `multitail`: ```dnf -y install multitail``` ([рис. @fig-011]).

![Установка multitail](image/11.png){#fig-011 width=70%}

## Просмотр журнала

Запустим multitail для просмотра журналов, но у меня он не работал ([рис. @fig-012]).

![Запуск multitail](image/12.png){#fig-012 width=70%}

## Просмотр журнала

При установке `lnav` через стандартные репозитории возникли проблемы с зависимостями и компиляцией. Для решения этой проблемы загрузим `lnav` с официального сайта и установим вручную. После установки `lnav` запустим его для просмотра журналов: ```lnav``` ([рис. @fig-013]).

![Установка и запуск lnav](image/13.png){#fig-013 width=70%}

## Просмотр журнала

В `lnav` видны сообщения как с сервера (`server`), так и с клиента (`client`), что подтверждает успешную настройку сетевого журналирования. Видны сообщения о процессах VBoxClient с обоих хостов ([рис. @fig-014]).

![Просмотр журналов в lnav](image/14.png){#fig-014 width=70%}

## Просмотр журнала

Для сравнения, на клиенте также проверим локальный журнал: ```tail -f /var/log/messages```. На клиенте видны только сообщения от локальных процессов, что подтверждает, что сообщения успешно пересылаются на сервер ([рис. @fig-015]).

![Просмотр журнала на клиенте](image/15.png){#fig-015 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

На виртуальной машине server перейдем в каталог для внесения изменений в настройки и создадим структуру каталогов: ```cd /vagrant/provision/server```, ```mkdir -p /vagrant/provision/server/netlog/etc/rsyslog.d```. Скопируем конфигурационный файл сервера: ```cp -R /etc/rsyslog.d/netlog-server.conf /vagrant/provision/server/netlog/etc/rsyslog.d``` ([рис. @fig-016]).

![Создание структуры каталогов на сервере](image/16.png){#fig-016 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Создадим исполняемый скрипт настройки для сервера: ```touch netlog.sh```, ```chmod +x netlog.sh``` ([рис. @fig-017]).

![Создание скрипта настройки на сервере](image/17.png){#fig-017 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Добавим в скрипт код ([рис. @fig-018]).

![Содержимое скрипта настройки сервера](image/18.png){#fig-018 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

На виртуальной машине client выполним аналогичные действия: ```cd /vagrant/provision/client```, ```mkdir -p /vagrant/provision/client/netlog/etc/rsyslog.d```. Скопируем конфигурационный файл клиента: ```cp -R /etc/rsyslog.d/netlog-client.conf /vagrant/provision/client/netlog/etc/rsyslog.d/``` ([рис. @fig-019]).

![Создание структуры каталогов на клиенте](image/19.png){#fig-019 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Создадим исполняемый скрипт настройки для клиента: ```touch netlog.sh```, ```chmod +x netlog.sh``` ([рис. @fig-021]).

![Создание скрипта настройки на клиенте](image/21.png){#fig-021 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Добавим в скрипт клиента код ([рис. @fig-020]).

![Содержимое скрипта настройки клиента](image/20.png){#fig-020 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

В конфигурационном файле Vagrantfile добавим вызовы созданных скриптов для сервера ([рис. @fig-022]) 

![Содержимое в файле Vagrantfile сервера](image/22.png){#fig-022 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

и клиента ([рис. @fig-023])

![Содержимое в файле Vagrantfile клиента](image/23.png){#fig-023 width=70%}

## Выводы 

В ходе выполннения лабораторной работы были получены навыки по работе с журналами системных событий.

