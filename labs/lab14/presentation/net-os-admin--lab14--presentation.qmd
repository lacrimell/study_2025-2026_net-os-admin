---
# Preamble

## Author
author:
  name: Калашникова Ольга Сергеевна
  email: 1132231846@pfur.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6

## Title
title: Презентация по лабораторной работе №14
subtitle: Администрирование сетевых подсистем
license: CC BY
date: 2025-12-06

## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги

## Fonts 
mainfont: Liberation Serif
romanfont: Liberation Serif
sansfont: Liberation Sans
monofont: Liberation Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9

## Formats
format:
### Pdf output format
  beamer:
    toc: true
    toc-title: Содержание
    number-sections: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
    pdf-engine: xelatex
    fontenc: T2A
#### Language
    babel-lang: russian
    babel-otherlangs: english

### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---
# Введение

## Цель работы

Приобретение навыков настройки доступа групп пользователей к общим ресурсам по протоколу SMB.

# Выполнение лабораторной работы

## Настройка сервера Samba

На сервере переключимся на пользователя root и установим необходимое программное обеспечение: ```dnf -y install samba samba-client cifs-utils``` ([рис. @fig-001]).

![Установка программного обеспечения Samba](image/1.png){#fig-001 width=70%}

## Настройка сервера Samba

Создадим группу `sambagroup` с GID 1010 для пользователей Samba: ```groupadd -g 1010 sambagroup``` ([рис. @fig-002]).

![Создание группы sambagroup](image/2.png){#fig-002 width=70%}

## Настройка сервера Samba

Добавим пользователя `oskalashnikova` в группу `sambagroup`: ```usermod -aG sambagroup oskalashnikova``` ([рис. @fig-003]).

![Добавление пользователя в группу](image/3.png){#fig-003 width=70%}

## Настройка сервера Samba

Создадим общий каталог для Samba-ресурсов: ```mkdir -p /srv/sambashare``` ([рис. @fig-004]).

![Создание общего каталога](image/4.png){#fig-004 width=70%}

## Настройка сервера Samba

В файле конфигурации `/etc/samba/smb.conf` изменим рабочую группу на `OSKALASHNIKOVA-NET` ([рис. @fig-005]).

![Настройка файла smb.conf](image/5.png){#fig-005 width=50%}

## Настройка сервера Samba

В файле конфигурации `/etc/samba/smb.conf` добавим раздел общего доступа `[sambashare]`: ```[global]```, ```workgroup = OSKALASHNIKOVA-NET```, ```security = user```, ```[sambashare]```, ```comment = My Samba Share```, ```path = /srv/sambashare```, ```write list = @sambagroup``` ([рис. @fig-006]).

![Настройка файла smb.conf (продолжение)](image/6.png){#fig-006 width=70%}

## Настройка сервера Samba

Проверим синтаксис файла конфигурации: ```testparm``` ([рис. @fig-007]).

![Проверка синтаксиса smb.conf](image/7.png){#fig-007 width=70%}

## Настройка сервера Samba

Запустим и включим службу Samba: ```systemctl start smb```, ```systemctl enable smb```, ```systemctl status smb``` ([рис. @fig-008]).

![Запуск службы Samba](image/8.png){#fig-008 width=70%}

## Настройка сервера Samba

Проверим наличие общих ресурсов с помощью `smbclient`: ```smbclient -L //server``` ([рис. @fig-009]).

![Проверка общих ресурсов](image/9.png){#fig-009 width=70%}

## Настройка сервера Samba

Посмотрим файл конфигурации межсетевого экрана для Samba: ```less /usr/lib/firewalld/services/samba.xml``` ([рис. @fig-010]).

![Файл конфигурации межсетевого экрана для Samba](image/10.png){#fig-010 width=70%}

## Настройка сервера Samba

Настроим межсетевой экран для службы Samba: ```firewall-cmd --add-service=samba```, ```firewall-cmd --add-service=samba --permanent```, ```firewall-cmd --reload``` ([рис. @fig-011]).

![Настройка межсетевого экрана](image/11.png){#fig-011 width=70%}

## Настройка сервера Samba

Настроим права доступа для общего каталога: ```chgrp sambagroup /srv/sambashare```, ```chmod g=rwx /srv/sambashare``` ([рис. @fig-012]).

![Настройка прав доступа](image/12.png){#fig-012 width=70%}

## Настройка сервера Samba

Посмотрим контекст безопасности SELinux для каталога `/srv`: ```ls -Z``` ([рис. @fig-013]).

![Просмотр контекста безопасности SELinux](image/13.png){#fig-013 width=70%}

## Настройка сервера Samba

Настроим контекст безопасности SELinux для каталога: ```semanage fcontext -a -t samba_share_t "/srv/sambashare(/.*)?"```, ```restorecon -vR /srv/sambashare``` ([рис. @fig-014]).

![Настройка SELinux контекста](image/14.png){#fig-014 width=70%}

## Настройка сервера Samba

Проверим, что контекст безопасности изменился: ```ls -Z``` ([рис. @fig-015]).

![Проверка изменения контекста безопасности SELinux](image/15.png){#fig-015 width=70%}

## Настройка сервера Samba

Разрешим экспорт ресурсов Samba на чтение и запись: ```setsebool samba_export_all_rw 1```, ```setsebool samba_export_all_rw 1 -P``` ([рис. @fig-016]).

![Разрешение экспорта через SELinux](image/16.png){#fig-016 width=70%}

## Настройка сервера Samba

Проверим идентификатор пользователя и группы: ```id``` ([рис. @fig-017]).

![Проверка UID и групп пользователя](image/17.png){#fig-017 width=70%}

## Настройка сервера Samba

Создадим тестовый файл от имени пользователя `oskalashnikova` в общем каталоге: ```cd /srv/sambashare```, ```touch oskalashnikova@server.txt``` ([рис. @fig-018]).

![Создание тестового файла на сервере](image/18.png){#fig-018 width=70%}

## Настройка сервера Samba

Добавим пользователя `oskalashnikova` в базу пользователей Samba: ```smbpasswd -L -a oskalashnikova``` ([рис. @fig-019]).

![Добавление пользователя в Samba](image/19.png){#fig-019 width=70%}

## Монтирование файловой системы Samba на клиенте

На клиенте переключимся на пользователя root и установим необходимые пакеты: ```dnf -y install samba-client cifs-utils``` ([рис. @fig-020]).

![Установка samba-client и cifs-utils на клиенте](image/20.png){#fig-020 width=70%}

## Монтирование файловой системы Samba на клиенте

Посмотрим файл конфигурации межсетевого экрана для клиента Samba: ```less /usr/lib/firewalld/services/samba-client.xml``` ([рис. @fig-021]).

![Файл конфигурации межсетевого экрана для клиента Samba](image/21.png){#fig-021 width=70%}

## Монтирование файловой системы Samba на клиенте

Настроим межсетевой экран на клиенте: ```firewall-cmd --add-service=samba-client```, ```firewall-cmd --add-service=samba-client --permanent```, ```firewall-cmd --reload``` ([рис. @fig-022]).

![Настройка межсетевого экрана на клиенте](image/22.png){#fig-022 width=70%}

## Монтирование файловой системы Samba на клиенте

Создадим группу `sambagroup` и добавим в неё пользователя `oskalashnikova`: ```groupadd -g 1010 sambagroup```, ```usermod -aG sambagroup oskalashnikova``` ([рис. @fig-023]).

![Создание группы и добавление пользователя на клиенте](image/23.png){#fig-023 width=70%}

## Монтирование файловой системы Samba на клиенте

В файле конфигурации `/etc/samba/smb.conf` изменим параметр рабочей группы: ```[global]```, ```workgroup = OSKALASHNIKOVA-NET```, ```security = user``` ([рис. @fig-024]).

![Настройка рабочей группы в smb.conf на клиенте](image/24.png){#fig-024 width=70%}

## Монтирование файловой системы Samba на клиенте

Для проверки наличия общего доступа подключимся с клиента к серверу с помощью smbclient: ```smbclient -L //server```. Просмотр ресурсов осуществляется под анонимной учётной записью ([рис. @fig-025]).

![Проверка общего доступа под анонимным пользователем](image/25.png){#fig-025 width=70%}

## Монтирование файловой системы Samba на клиенте

Подключимся с клиента к серверу под учётной записью пользователя `oskalashnikova`: ```smbclient -L //server -U oskalashnikova```. Просмотр ресурсов осуществляется под учётной записью `oskalashnikova` ([рис. @fig-026]).

![Проверка общего доступа под пользователем oskalashnikova](image/26.png){#fig-026 width=70%}

## Монтирование файловой системы Samba на клиенте

На клиенте создадим точку монтирования: ```mkdir /mnt/samba``` ([рис. @fig-027]).

![Создание точки монтирования](image/27.png){#fig-027 width=70%}

## Монтирование файловой системы Samba на клиенте

Получим доступ к общему ресурсу с помощью mount: ```mount -o username=oskalashnikova,user,rw,uid=oskalashnikova,gid=sambagroup //server/sambashare /mnt/samba``` ([рис. @fig-028]).

![Монтирование общего ресурса Samba](image/28.png){#fig-028 width=70%}

## Монтирование файловой системы Samba на клиенте

Убедимся, что пользователь `oskalashnikova` может записывать файлы на разделяемом ресурсе: ```cd /mnt/samba```, ```touch oskalashnikova@client.txt``` ([рис. @fig-029]).

![Создание файла на клиенте](image/29.png){#fig-029 width=70%}

## Монтирование файловой системы Samba на клиенте

Отмонтируем каталог `/mnt/samba`: ```umount /mnt/samba``` ([рис. @fig-030]).

![Отмонтирование каталога](image/30.png){#fig-030 width=70%}

## Монтирование файловой системы Samba на клиенте

Проверим, какие процессы используют каталог: ```lsof /mnt/samba``` ([рис. @fig-031]).

![Проверка процессов, использующих каталог](image/31.png){#fig-031 width=70%}

## Монтирование файловой системы Samba на клиенте

Снова монтируем и отмонтируем каталог: ```mount -o username=oskalashnikova,user,rw,uid=oskalashnikova,gid=sambagroup //server/sambashare /mnt/samba```, ```umount /mnt/samba``` ([рис. @fig-032]).

![Повторное монтирование и отмонтирование](image/32.png){#fig-032 width=70%}

## Монтирование файловой системы Samba на клиенте

Создадим файл учётных данных: ```touch /etc/samba/smbusers```, ```chmod 600 /etc/samba/smbusers``` ([рис. @fig-033]).

![Создание файла smbusers](image/33.png){#fig-033 width=70%}

## Монтирование файловой системы Samba на клиенте

Заполним файл `/etc/samba/smbusers` данными пользователя: ```username=oskalashnikova```, ```password=123456``` ([рис. @fig-034]).

![Заполнение файла smbusers](image/34.png){#fig-034 width=70%}

## Монтирование файловой системы Samba на клиенте

Добавим строку в файл `/etc/fstab` для автоматического монтирования: ```//server/sambashare /mnt/samba cifs user,rw,uid=oskalashnikova,gid=sambagroup,credentials=/etc/samba/smbusers,_netdev 0 0``` ([рис. @fig-035]).

![Добавление записи в fstab](image/35.png){#fig-035 width=70%}

## Монтирование файловой системы Samba на клиенте

Подмонтируем общий ресурс: ```mount -a``` ([рис. @fig-036]).

![Монтирование с помощью fstab](image/36.png){#fig-036 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

На виртуальной машине server перейдем в каталог для внесения изменений в настройки внутреннего окружения, создадим каталог smb и скопируем в него конфигурационные файлы: ```cd /vagrant/provision/server```, ```mkdir -p /vagrant/provision/server/smb/etc/samba```, ```cp -R /etc/samba/smb.conf /vagrant/provision/server/smb/etc/samba/``` ([рис. @fig-037]).

![Создание каталога и копирование конфигурационных файлов на сервере](image/37.png){#fig-037 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

В каталоге `/vagrant/provision/server` создадим исполняемый файл `smb.sh`: ```cd /vagrant/provision/server```, ```touch smb.sh```, ```chmod +x smb.sh``` ([рис. @fig-038]).

![Создание исполняемого файла smb.sh на сервере](image/38.png){#fig-038 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Откроем файл на редактирование и пропишем в нём скрипт для настройки Samba сервера ([рис. @fig-039]).

![Редактирование скрипта smb.sh для сервера](image/39.png){#fig-039 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

На виртуальной машине client перейдем в каталог для внесения изменений в настройки внутреннего окружения, создадим каталог smb и скопируем в него конфигурационные файлы: ```cd /vagrant/provision/client```, ```mkdir -p /vagrant/provision/client/smb/etc/samba```, ```cp -R /etc/samba/smb.conf /vagrant/provision/client/smb/etc/samba/```, ```cp -R /etc/samba/smbusers /vagrant/provision/client/smb/etc/samba/``` ([рис. @fig-040]).

![Создание каталога и копирование конфигурационных файлов на клиенте](image/40.png){#fig-040 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

В каталоге `/vagrant/provision/client` создадим исполняемый файл `smb.sh`: ```cd /vagrant/provision/client```, ```touch smb.sh```, ```chmod +x smb.sh``` ([рис. @fig-041]).

![Создание исполняемого файла smb.sh на клиенте](image/41.png){#fig-041 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Откроем файл на редактирование и пропишем в нём скрипт для настройки Samba клиента ([рис. @fig-042]).

![Редактирование скрипта smb.sh для клиента](image/42.png){#fig-042 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

Для отработки созданных скриптов во время загрузки виртуальных машин server и client в конфигурационном файле Vagrantfile добавим в соответствующих разделах конфигураций для сервера ([рис. @fig-043]).

![Добавление provision для сервера в Vagrantfile](image/43.png){#fig-043 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальных машин

И для клиента ([рис. @fig-044]).

![Добавление provision для клиента в Vagrantfile](image/44.png){#fig-044 width=70%}

## Вывод

В ходе выполнения лабораторной работы были приобретены навыки настройки доступа групп пользователей к общим ресурсам по протоколу SMB

