---
# Preamble

## Author
author:
  name: Калашникова Ольга Сергеевна
  email: 1132231846@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Отчёт по лабораторной работе №2"
subtitle: "Дисциплина: Администрирование сетевых подсистем"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[math,RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Целью данной работы является приобретение практических навыков по установке и конфигурированию DNS-сервера, усвоение принципов работы системы доменных имён.

# Задание

1.  Установить на виртуальной машине server DNS-сервер bind и bind-utils.
2.  Сконфигурировать на виртуальной машине server кэширующий DNS-сервер.
3.  Сконфигурировать на виртуальной машине server первичный DNS-сервер.
4.  При помощи утилит `dig` и `host` проанализировать работу DNS-сервера.
5.  Написать скрипт для Vagrant, фиксирующий действия по установке и конфигурированию DNS-сервера во внутреннем окружении виртуальной машины server. Соответствующим образом внести изменения в Vagrantfile.

# Выполнение лабораторной работы

## Установка DNS-сервера

Загрузили операционную систему и перешли в рабочий каталог с проектом: `cd /var/tmp/oskalashnikova/vagrant`.

Запустили виртуальную машину server: `make server-up`.

Далее на виртуальной машине server вошли под созданным пользователем `oskalashnikova` и открыли терминал. Перешли в режим суперпользователя: `sudo -i` ([рис. @fig-001]).

![Переход в режим суперпользователя](image/1.png){#fig-001 width=70%}

Установили пакеты `bind` и `bind-utils` с помощью менеджера пакетов `dnf`: `dnf -y install bind bind-utils`. Процесс загрузки и установки пакетов показан на ([рис. @fig-002]).

![Установка пакетов bind и bind-utils](image/2.png){#fig-002 width=70%}

После установки, в качестве упражнения, с помощью утилиты `dig` выполнили запрос к DNS-адресу `www.yandex.ru`: `dig www.yandex.ru`. Результат запроса показал, что разрешение имен работает, но изначально запросы шли к внешнему DNS-серверу (в данном случае IPv6-адресу) ([рис. @fig-003]).

![Тестовый запрос к www.yandex.ru с помощью dig](image/3.png){#fig-003 width=70%}

## Конфигурирование кэширующего DNS-сервера

### Настройка сетевого соединения для использования локального DNS

Чтобы сделать локальный DNS-сервер сервером по умолчанию для хоста `server`, необходимо изменить настройки сетевого соединения. Открыли интерактивный редактор соединений `nmcli` для интерфейса `eth0` ([рис. @fig-005]):

```bash
nmcli connection edit eth0
```

![Вход в интерактивный редактор nmcli для eth0](image/5.png){#fig-005 width=70%}

В редакторе выполнили последовательность команд для настройки DNS ([рис. @fig-006]):

1.  Удалили автоматически назначенные DNS-серверы: `remove ipv4.dns`.
2.  Отключили автоматическое получение DNS: `set ipv4.ignore-auto-dns yes`.
3.  Установили локальный DNS-сервер: `set ipv4.dns 127.0.0.1`.
4.  Сохранили изменения: `save`.
5.  Выйшли из редактора: `quit`.

![Настройка DNS в nmcli для eth0](image/6.png){#fig-006 width=70%}

После настройки перезапустили службу `NetworkManager` для применения изменений: `systemctl restart NetworkManager` ([рис. @fig-007]).

![Перезапуск NetworkManager](image/7.png){#fig-007 width=70%}

### Настройка конфигурации DNS-сервера BIND (named)

Для разрешения DNS-запросов от всех узлов внутренней сети (например, с адресами 192.168.0.0/16) необходимо изменить основной конфигурационный файл BIND `/etc/named.conf`.

Открыли файл для редактирования и изменили ключевые директивы:

1.  Директива `listen-on` была изменена, чтобы сервер прослушивал запросы не только на localhost, но и на всех интерфейсах (`any`):
    ```apache
    listen-on port 53 { 127.0.0.1; any; };
    ```
2.  Директива `allow-query` была изменена, чтобы разрешать запросы не только с localhost, но и с узлов внутренней сети:
    ```apache
    allow-query    { localhost; 192.168.0.0/16; };
    ```

Фрагмент измененного файла конфигурации показан на ([рис. @fig-008]).

![Изменение настроек listen-on и allow-query в /etc/named.conf](image/8.png){#fig-008 width=70%}

### Настройка межсетевого экрана

Чтобы разрешить входящие DNS-запросы на сервер, добавили службу `dns` в правила межсетевого экрана `firewalld` ([рис. @fig-009]):

```bash
firewall-cmd --add-service=dns
firewall-cmd --add-service=dns --permanent
```

![Добавление правила firewall для службы DNS](image/9.png){#fig-009 width=70%}

### Запуск и проверка работы DNS-сервера

Включили автозапуск службы `named` при загрузке системы и запустили её ([рис. @fig-004]):

```bash
systemctl enable named
systemctl start named
```

![Включение автозапуска и запуск службы named](image/4.png){#fig-004 width=70%}

Для проверки, что демон `named` запущен и прослушивает UDP-порт 53 (стандартный порт для DNS), использовали команду `lsof | grep UDP`. Вывод команды показывает несколько процессов `named`, слушающих порт 53 на localhost для протоколов IPv4 и IPv6 ([рис. @fig-010]).

![Проверка прослушивания UDP-порта 53 процессом named](image/10.png){#fig-010 width=70%}

### Конфигурирование кэширующего DNS-сервера при наличии фильтрации DNS-запросов маршрутизаторами

В случае, когда DNS-запросы от сервера фильтруются сетевым оборудованием, необходимо добавить перенаправление запросов на конкретный вышестоящий DNS-сервер. Для этого в конфигурационный файл `/etc/named.conf` в секцию `options` были добавлены директивы ([рис. @fig-011]):

```apache
forwarders { 192.168.0.1; };
forward first;
```

![Настройка перенаправления запросов (forwarders)](image/11.png){#fig-011 width=70%}

Кроме того, если вышестоящий DNS-сервер не поддерживает технологию DNSSEC, следует отключить её проверку. Однако, как было выявлено позже, используемая версия BIND не поддерживает старую опцию `dnssec-enable`. Актуальный метод отключения DNSSEC-валидации — использование только опции `dnssec-validation no;`. Исходные строки, которые пришлось удалить, показаны на ([рис. @fig-012]).

![Устаревшие настройки DNSSEC (пришлось удалить)](image/12.png){#fig-012 width=70%}

### Анализ работы кэширующего DNS-сервера

После настройки и запуска локального кэширующего DNS-сервера можно проанализировать его работу. Ранее запрос `dig www.yandex.ru` выполнялся к внешнему серверу. После настройки локального кэширующего сервера и указания его адреса (127.0.0.1) в настройках сети, аналогичные запросы будут обрабатываться локально. Разница в выводимой информации будет заключаться в строке `SERVER:`, где вместо внешнего адреса будет указан `127.0.0.1#53(127.0.0.1)`.

## Конфигурирование первичного DNS-сервера

### Создание файла описания зон

Скопировали шаблон описания DNS-зон `/etc/named.rfc1912.zones` в каталог `/etc/named` и переименовали его в `oskalashnikova.net` ([рис. @fig-013]):

```bash
cp /etc/named.rfc1912.zones /etc/named/
cd /etc/named
mv /etc/named/named.rfc1912.zones /etc/named/oskalashnikova.net
```

![Копирование и переименование файла зон](image/13.png){#fig-013 width=70%}

Включили файл описания зоны `/etc/named/oskalashnikova.net` в основной конфигурационный файл DNS `/etc/named.conf`, добавив в него строку ([рис. @fig-014]):

```apache
include "/etc/named/oskalashnikova.net";
```

![Добавление include в named.conf](image/14.png){#fig-014 width=70%}

Открыли файл `/etc/named/oskalashnikova.net` на редактирование и вместо стандартных зон прописали свою прямую и обратную зоны ([рис. @fig-015], [рис. @fig-016]):

Прямая зона:
```apache
zone "oskalashnikova.net" IN {
    type master;
    file "master/fz/oskalashnikova.net";
    allow-update { none; };
};
```

![Настройка прямой зоны в файле oskalashnikova.net](image/15.png){#fig-015 width=70%}

Обратная зона:
```apache
zone "1.168.192.in-addr.arpa" IN {
    type master;
    file "master/rz/192.168.1";
    allow-update { none; };
};
```

![Настройка обратной зоны в файле oskalashnikova.net](image/16.png){#fig-016 width=70%}

Остальные записи в файле `/etc/named/oskalashnikova.net` были удалены. Итоговое содержимое файла показано на ([рис. @fig-026]).

![Итоговое содержимое файла oskalashnikova.net](image/26.png){#fig-026 width=70%}

### Создание структуры каталогов для зон

В каталоге `/var/named` создали подкаталоги `master/fz` и `master/rz`, в которых будут располагаться файлы прямой и обратной зоны соответственно ([рис. @fig-017]):

```bash
cd /var/named
mkdir -p /var/named/master/fz
mkdir -p /var/named/master/rz
```

![Создание каталогов для файлов зон](image/17.png){#fig-017 width=70%}

### Создание и настройка файла прямой зоны

Скопировали шаблон прямой DNS-зоны `named.localhost` из каталога `/var/named` в каталог `/var/named/master/fz` и переименовали его в `oskalashnikova.net` ([рис. @fig-018]):

```bash
cp /var/named/named.localhost /var/named/master/fz/
cd /var/named/master/fz/
mv named.localhost oskalashnikova.net
```

![Копирование шаблона для прямой зоны](image/18.png){#fig-018 width=70%}

Изменили файл `/var/named/master/fz/oskalashnikova.net`, указав необходимые DNS-записи для прямой зоны ([рис. @fig-019]):

```apache
$TTL 1D
@    IN SOA    @ server.oskalashnikova.net. (
    2025091300    ; serial
    1D    ; refresh
    1H    ; retry
    1W    ; expire
    3H )    ; minimum
    NS    @
    A    192.168.1.1

$ORIGIN oskalashnikova.net.
server    A    192.168.1.1
ns    A    192.168.1.1
```

![Содержимое файла прямой зоны oskalashnikova.net](image/19.png){#fig-019 width=70%}

### Создание и настройка файла обратной зоны

Скопировали шаблон обратной DNS-зоны `named.loopback` из каталога `/var/named` в каталог `/var/named/master/rz` и переименовали его в `192.168.1` ([рис. @fig-020]):

```bash
cp /var/named/named.loopback /var/named/master/rz/
cd /var/named/master/rz/
mv named.loopback 192.168.1
```

![Копирование шаблона для обратной зоны](image/20.png){#fig-020 width=70%}

Изменили файл `/var/named/master/rz/192.168.1`, указав необходимые DNS-записи для обратной зоны ([рис. @fig-021]):

```apache
$TTL 1D
@    IN SOA    @ server.oskalashnikova.net. (
    2025091300    ; serial
    1D    ; refresh
    1H    ; retry
    1W    ; expire
    3H )    ; minimum
    NS    @
    A    192.168.1.1
    PTR    server.oskalashnikova.net.
$ORIGIN 1.168.192.in-addr.arpa.
1    PTR    server.oskalashnikova.net.
1    PTR    ns.oskalashnikova.net.
```

![Содержимое файла обратной зоны 192.168.1](image/21.png){#fig-021 width=70%}

### Настройка прав доступа и SELinux

Исправили права доступа к файлам в каталогах `/etc/named` и `/var/named`, чтобы демон `named` мог с ними работать ([рис. @fig-022]):

```bash
chown -R named:named /etc/named
chown -R named:named /var/named
```

![Изменение владельца файлов конфигурации](image/22.png){#fig-022 width=70%}

Восстановили метки безопасности SELinux после внесения изменений в конфигурационные файлы ([рис. @fig-023]):

```bash
restorecon -vR /etc
restorecon -vR /var/named
```

![Восстановление контекста SELinux](image/23.png){#fig-023 width=70%}

Проверили состояние переключателей SELinux, относящихся к `named`, и дали разрешение на запись в файлы DNS-зон ([рис. @fig-024]):

```bash
getsebool -a | grep named
setsebool named_write_master_zones 1
setsebool -P named_write_master_zones 1
```

![Настройка булевых переключателей SELinux для named](image/24.png){#fig-024 width=70%}

### Запуск и проверка работы первичного DNS-сервера

При попытке перезапуска службы `named` возникла ошибка ([рис. @fig-025]). Анализ журнала показал, что в конфигурационном файле `/etc/named.conf` использовалась устаревшая опция `dnssec-enable`, которая больше не поддерживается в текущей версии BIND.

![Ошибка при перезапуске named из-за устаревшей опции](image/25.png){#fig-025 width=70%}

Удалили устаревшие строки из конфигурационного файла `/etc/named.conf`:
```apache
dnssec-enable no;
dnssec-validation no;
```

После исправления конфигурации успешно перезапустили DNS-сервер ([рис. @fig-027]):

```bash
systemctl restart named
```

![Успешный перезапуск службы named](image/27.png){#fig-027 width=70%}

### Анализ работы DNS-сервера

#### Проверка работы с помощью утилиты dig

При помощи утилиты `dig` получили описание DNS-записи для сервера `ns.oskalashnikova.net` ([рис. @fig-028]):

```bash
dig ns.oskalashnikova.net
```

Команда вернула корректный ответ: `ns.oskalashnikova.net` имеет IP-адрес `192.168.1.1`. Важно отметить, что в строке `SERVER:` указан `127.0.0.1#53`, что подтверждает, что запрос был обработан локальным DNS-сервером. Флаг `aa` (authoritative answer) в заголовке ответа указывает на то, что ответ является авторитетным, т.е. получен от сервера, ответственного за зону `oskalashnikova.net`.

![Проверка A-записи для ns.oskalashnikova.net с помощью dig](image/28.png){#fig-028 width=70%}

#### Проверка работы с помощью утилиты host

Проанализировали корректность работы DNS-сервера с помощью различных опций утилиты `host` ([рис. @fig-029]):

1.  **Перечисление всех записей в зоне:**
    ```bash
    host -l oskalashnikova.net
    ```
    Команда успешно вывела все узлы в зоне `oskalashnikova.net`: сам домен, `ns` и `server`, все с адресом `192.168.1.1`.

2.  **Подробная информация о зоне (режим ANY):**
    ```bash
    host -a oskalashnikova.net
    ```
    Вывод показывает SOA-запись, NS-запись и A-запись для домена. Серийный номер соответствует заданному в файле зоны (`2025091300`).

3.  **Запрос конкретного типа записи:**
    ```bash
    host -t A oskalashnikova.net
    ```
    Корректно возвращена A-запись с адресом `192.168.1.1`.

4.  **Проверка PTR-записи (негативный тест):**
    ```bash
    host -t PTR oskalashnikova.net
    ```
    Как и ожидалось, PTR-запись для доменного имени не найдена, поскольку PTR-записи существуют только для IP-адресов в обратных зонах.

![Тестирование работы DNS-сервера с помощью утилиты host](image/29.png){#fig-029 width=70%}

## Внесение изменений в настройки внутреннего окружения виртуальной машины

### Подготовка конфигурационных файлов для автоматического развертывания

Для автоматизации процесса установки и настройки DNS-сервера при создании виртуальной машины подготовили структуру каталогов и скопировали все созданные конфигурационные файлы в директорию `/vagrant/provision/server/dns/` ([рис. @fig-030]):

```bash
cd /vagrant
mkdir -p /vagrant/provision/server/dns/etc/named
mkdir -p /vagrant/provision/server/dns/var/named/master/
cp -R /etc/named.conf /vagrant/provision/server/dns/etc/
cp -R /etc/named/* /vagrant/provision/server/dns/etc/named/
cp -R /var/named/master/* /vagrant/provision/server/dns/var/named/master/
```

![Копирование конфигурационных файлов DNS в директорию provision](image/30.png){#fig-030 width=70%}

### Создание скрипта автоматической настройки DNS

В каталоге `/vagrant/provision/server/` создали исполняемый файл `dns.sh` ([рис. @fig-031]):

```bash
cd /vagrant/provision/server/
touch dns.sh
chmod +x dns.sh
```

![Создание исполняемого скрипта dns.sh](image/31.png){#fig-031 width=70%}

Открыв файл на редактирование, прописали в нём следующий скрипт, который повторяет все произведённые действия по установке и настройке DNS-сервера ([рис. @fig-032]):

```bash
#!/bin/bash

echo "Provisioning script $0"

echo "Install needed packages"
dnf -y install bind bind-utils

echo "Copy configuration files"
cp -R /vagrant/provision/server/dns/etc/* /etc
cp -R /vagrant/provision/server/dns/var/named/* /var/named

chown -R named:named /etc/named
chown -R named:named /var/named

restorecon -vR /etc
restorecon -vR /var/named

echo "Configure firewall"
firewall-cmd --add-service-dns
firewall-cmd --add-service-dns --permanent

echo "Tuning SELinux"
setsebool named_write_master_zones 1
setsebool -P named_write_master_zones 1

echo "Change dns server address"
nmcli connection edit "System eth0" <<EOF
remove ipv4.dns
set ipv4.ignore-auto-dns yes
set ipv4.dns 127.0.0.1
save
quit
EOF
systemctl restart NetworkManager

echo "Start named service"
systemctl enable named
systemctl start named
```

**Пояснение к содержанию скрипта:**
1. **Установка пакетов:** Устанавливает `bind` и `bind-utils` с помощью `dnf`.
2. **Копирование конфигурации:** Копирует подготовленные конфигурационные файлы из директории `/vagrant/provision/server/dns/` в целевые системные каталоги.
3. **Настройка прав доступа:** Меняет владельца файлов конфигурации и зон на пользователя и группу `named`.
4. **Восстановление контекста SELinux:** Применяет правильные метки безопасности SELinux к изменённым файлам и каталогам.
5. **Настройка брандмауэра:** Добавляет правило, разрешающее работу службы DNS через `firewalld`, и делает его постоянным.
6. **Настройка SELinux:** Включает булев переключатель, разрешающий демону `named` запись в файлы мастер-зон.
7. **Конфигурация сетевого соединения:** Автоматически настраивает сетевое соединение "System eth0" для использования локального DNS-сервера (127.0.0.1) через интерактивные команды `nmcli`.
8. **Запуск службы:** Включает автозапуск и немедленно запускает службу `named`.

![Содержимое скрипта dns.sh](image/32.png){#fig-032 width=70%}

### Интеграция скрипта в конфигурацию Vagrant

Для автоматического выполнения созданного скрипта во время загрузки виртуальной машины `server` необходимо добавить соответствующую директиву в конфигурационный файл `Vagrantfile` ([рис. @fig-033]):

```ruby
server.vm.provision "server_dns",
  type: "shell",
  preserve_order: true,
  path: "provision/server/dns.sh"
```

**Пояснение:**
- **`server.vm.provision`:** Определяет provisioner для виртуальной машины `server`.
- **`"server_dns"`:** Произвольное имя для этого provisioner.
- **`type: "shell"`:** Указывает, что provisioner выполняет shell-скрипт.
- **`preserve_order: true`:** Гарантирует, что этот provisioner будет выполнен после других, если они есть.
- **`path: "provision/server/dns.sh"`:** Относительный путь к скрипту от корня проекта Vagrant.

![Добавление provisioner в Vagrantfile](image/33.png){#fig-033 width=70%}

# Контрольные вопросы

1.  **Что такое DNS?** DNS (Domain Name System) — это распределенная система, которая преобразует удобочитаемые доменные имена (например, `www.example.com`) в машиночитаемые IP-адреса (например, `192.0.2.1`) и наоборот.
2.  **Каково назначение кэширующего DNS-сервера?** Кэширующий DNS-сервер получает рекурсивные запросы от клиентов, выполняет последовательные запросы к авторитетным серверам для разрешения имени, возвращает ответ клиенту и временно сохраняет (кэширует) результат. Это ускоряет последующие запросы к тем же именам и снижает нагрузку на внешние DNS-серверы.
3.  **Чем отличается прямая DNS-зона от обратной?** Прямая зона (forward zone) сопоставляет доменные имена с IP-адресами (записи A, AAAA). Обратная зона (reverse zone) сопоставляет IP-адреса с доменными именами (записи PTR) и используется в домене специального назначения `in-addr.arpa` (для IPv4) или `ip6.arpa` (для IPv6).
4.  **В каких каталогах и файлах располагаются настройки DNS-сервера? Кратко охарактеризуйте, за что они отвечают.**
    *   `/etc/named.conf` — основной конфигурационный файл BIND, определяет глобальные параметры, зоны и их типы.
    *   `/etc/named/` — каталог для дополнительных файлов конфигурации зон.
    *   `/var/named/` — рабочий каталог BIND, здесь хранятся файлы данных зон (прямые и обратные).
    *   `/var/run/named/` — каталог для файлов состояния и сокетов.
5.  **Что указывается в файле resolv.conf?** Файл `/etc/resolv.conf` содержит конфигурацию DNS-клиента: IP-адреса DNS-серверов, используемых для разрешения имен (директива `nameserver`), доменный поисковый суффикс (директива `search` или `domain`).
6.  **Какие типы записи описания ресурсов есть в DNS и для чего они используются?**
    *   **SOA (Start of Authority)** — указывает на авторитетность сервера для зоны, содержит служебную информацию (контакт, серийный номер, тайминги).
    *   **NS (Name Server)** — перечисляет авторитетные DNS-серверы для зоны.
    *   **A / AAAA** — сопоставляют имя хоста с IPv4 (A) или IPv6 (AAAA) адресом.
    *   **PTR (Pointer)** — сопоставляет IP-адрес с именем хоста (используется в обратных зонах).
    *   **CNAME (Canonical Name)** — задает псевдоним (алиас) для канонического имени хоста.
    *   **MX (Mail Exchanger)** — указывает почтовые серверы для домена.
7.  **Для чего используется домен in-addr.arpa?** Домен `in-addr.arpa` используется для организации обратного просмотра DNS (reverse DNS lookup) для адресов IPv4. IP-адрес записывается в обратном порядке и добавляется к `.in-addr.arpa.`, формируя имя для PTR-записи (например, для `192.168.1.1` имя будет `1.1.168.192.in-addr.arpa.`).
8.  **Для чего нужен демон named?** `named` — это демон (фоновый процесс), который является реализацией DNS-сервера BIND (Berkeley Internet Name Domain). Он отвечает за обработку DNS-запросов, управление зонами и обеспечение работы DNS-сервера.
9.  **В чём заключаются основные функции slave-сервера и master-сервера?**
    *   **Master (Primary) сервер** — авторитетный сервер, на котором хранятся основные (мастер-копии) файлов данных зоны. Изменения в зоне вносятся именно здесь.
    *   **Slave (Secondary) сервер** — авторитетный сервер, который получает копии данных зоны с master-сервера через механизм трансфера зон (zone transfer). Обеспечивает избыточность и распределение нагрузки.
10. **Какие параметры отвечают за время обновления зоны?** В SOA-записи:
    *   `refresh` — интервал, через который slave-сервер проверяет у master-сервера наличие обновлений.
    *   `retry` — интервал, через который slave-сервер повторяет попытку связи с master-сервером в случае неудачи.
    *   `expire` — время, по истечении которого slave-сервер перестанет быть авторитетным для зоны, если не сможет обновиться.
    *   `minimum` (часто используется как `negative caching TTL`) — время кэширования отрицательных ответов.

# Выводы

В ходе выполнения лабораторной работы №2 были приобретены практические навыки по установке и конфигурированию DNS-сервера на основе BIND. Были выполнены следующие задачи:

1.  Установлены необходимые пакеты `bind` и `bind-utils`.
2.  Настроен кэширующий DNS-сервер:
    *   Изменена сетевая конфигурация через `nmcli` для использования локального DNS (127.0.0.1).
    *   Отредактирован конфигурационный файл `/etc/named.conf` для прослушивания запросов на всех интерфейсах и разрешения запросов из внутренней сети.
    *   Добавлено правило в `firewalld` для разрешения службы `dns`.
    *   Служба `named` запущена и добавлена в автозагрузку.
    *   Проверено, что сервер прослушивает UDP-порт 53.
3.  Настроен первичный (master) DNS-сервер для домена `oskalashnikova.net`:
    *   Создан файл описания зон `/etc/named/oskalashnikova.net` с прямой зоной для домена и обратной зоной для подсети `192.168.1.0/24`.
    *   Созданы и заполнены файлы данных зон: прямая (`/var/named/master/fz/oskalashnikova.net`) и обратная (`/var/named/master/rz/192.168.1`).
    *   Настроены корректные права доступа (`chown named:named`) и контекст безопасности SELinux (`restorecon`, `setsebool`).
    *   Исправлена ошибка конфигурации, связанная с устаревшей опцией `dnssec-enable`.
    *   Служба `named` успешно перезапущена.
4.  Проанализирована работа DNS-сервера с помощью утилит `dig` и `host`:
    *   Показана работа локального кэширующего сервера (запросы к `127.0.0.1`).
    *   Подтверждена корректная работа авторитетного сервера для домена `oskalashnikova.net` (флаг `aa`, вывод всех записей зоны).
    *   Протестированы различные типы запросов (A, ANY, перечисление зоны).
5.  Рассмотрена настройка перенаправления запросов (`forwarders`) для работы в сетях с фильтрацией DNS.
6.  **Автоматизирован процесс развертывания:**
    *   Подготовлены конфигурационные файлы для provision.
    *   Создан shell-скрипт `dns.sh`, который полностью автоматизирует установку и настройку DNS-сервера.
    *   Скрипт интегрирован в `Vagrantfile`, что позволяет автоматически развертывать настроенный DNS-сервер при создании виртуальной машины.

В результате был развернут полнофункциональный DNS-сервер, выполняющий две основные роли: кэширующий сервер для ускорения разрешения внешних имен и первичный авторитетный сервер для собственного домена. Были освоены ключевые аспекты администрирования BIND: работа с основным конфигурационным файлом, создание и редактирование зон, управление правами доступа и политиками SELinux, диагностика с помощью сетевых утилит. Особенно важным достижением является автоматизация всего процесса настройки через механизм provision в Vagrant, что соответствует современным практикам DevOps и Infrastructure as Code. Полученные навыки являются фундаментальными для построения и поддержки сетевой инфраструктуры.
